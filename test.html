<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Send PUT Request to GitHub</title>
  <!-- Octokit REST browser version -->
  <script src="https://cdn.jsdelivr.net/npm/@octokit/rest/dist/octokit.umd.js"></script>
</head>
<body>
  <h2>Send Confession</h2>
  <button onclick="sendConfession()">Send</button>

  <script>
    async function sendConfession() {
      const octokit = new Octokit.Octokit({
        auth: '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' // ğŸ” Replace with your GitHub token
      });

      const newObject = {
        Pic: "https://i.ibb.co/Y4chzM6F/86689165-af12-49dd-b2e1-351fbbe5fcc6-Photoroom.png",
        Name: "Anonymous",
        Confess: "thank you mohit for making this app and your efforts must be appreciated ğŸ™ğŸ˜„ğŸ’—",
        Tick: "blue",
        Roll: "53"
      };

      const owner = 'Mohitmali5489'; // ğŸ” Replace with GitHub owner
      const repo = 'Chats';   // ğŸ” Replace with repository name
      const path = 'test.json';   // ğŸ” Replace with file path (e.g., data/confessions.json)

      try {
        const { data } = await octokit.repos.getContent({ owner, repo, path });
        const sha = data.sha;
        const contentDecoded = atob(data.content.replace(/\n/g, ''));
        let contentJSON = JSON.parse(contentDecoded);
        contentJSON.push(newObject);
        const updatedContent = btoa(JSON.stringify(contentJSON, null, 2));

        await octokit.repos.createOrUpdateFileContents({
          owner,
          repo,
          path,
          message: 'Add new confession',
          content: updatedContent,
          sha,
          committer: {
            name: 'Monalisa Octocat',
            email: 'octocat@github.com'
          }
        });

        alert('Confession added successfully!');
      } catch (e) {
        console.error(e);
        alert('Error: ' + e.message);
      }
    }
  </script>
</body>
</html>
