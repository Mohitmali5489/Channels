<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Send Confession</title>
  <script src="https://cdn.jsdelivr.net/npm/@octokit/rest@19.0.7/dist/octokit-rest.min.js"></script>
</head>
<body>
  <h2>Send Confession</h2>
  <button onclick="sendConfession()">Send</button>

  <script>
    async function sendConfession() {
      const octokit = new window.Octokit({
        auth: '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' // üîê Replace with your GitHub token
      });

      const owner = 'Mohitmali5489'; // GitHub username/org
      const repo = 'Chats';   // GitHub repo name
      const path = 'test.json';   // Path to the JSON file

      const newObject = {
        Pic: "https://i.ibb.co/Y4chzM6F/86689165-af12-49dd-b2e1-351fbbe5fcc6-Photoroom.png",
        Name: "Anonymous",
        Confess: "thank you mohit for making this app and your efforts must be appreciated üôèüòÑüíó",
        Tick: "blue",
        Roll: "53"
      };

      try {
        const { data } = await octokit.repos.getContent({
          owner,
          repo,
          path
        });

        const sha = data.sha;
        const contentDecoded = atob(data.content.replace(/\n/g, ''));
        const contentJSON = JSON.parse(contentDecoded);

        contentJSON.push(newObject);

        const updatedContent = btoa(JSON.stringify(contentJSON, null, 2));

        await octokit.repos.createOrUpdateFileContents({
          owner,
          repo,
          path,
          message: "Add new confession",
          content: updatedContent,
          sha,
          committer: {
            name: "Monalisa Octocat",
            email: "octocat@github.com"
          }
        });

        alert("Confession added successfully!");
      } catch (e) {
        console.error(e);
        alert("Error: " + e.message);
      }
    }
  </script>
</body>
</html>
